<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Coding Crossover â€“ FCOR 599: Workshop Artifacts</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../CodingCrossover/codingcrossover.html">Coding Crossover</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../images/MGEM_logo.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../Cartography/cartography.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Cartography</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Cartography/art_of_maps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The Art of Map Making</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Cartography/arcgis_pro_demo.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ArcGIS Pro Demo</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../Interactive_Maps/interactive_maps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interactive Maps</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Interactive_Maps/leaflet.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Leaflet</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../E-Portfolio/eportfolio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">E-portfolio</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../CodingCrossover/codingcrossover.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Coding Crossover</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#key-differences-in-python-vs.-r" id="toc-key-differences-in-python-vs.-r" class="nav-link active" data-scroll-target="#key-differences-in-python-vs.-r">Key Differences in Python vs.&nbsp;R</a></li>
  <li><a href="#common-geomatics-libraries" id="toc-common-geomatics-libraries" class="nav-link" data-scroll-target="#common-geomatics-libraries">Common Geomatics Libraries</a></li>
  <li><a href="#importing-libraries" id="toc-importing-libraries" class="nav-link" data-scroll-target="#importing-libraries">Importing Libraries</a></li>
  <li><a href="#cheat-sheet-common-geomatics-functions" id="toc-cheat-sheet-common-geomatics-functions" class="nav-link" data-scroll-target="#cheat-sheet-common-geomatics-functions">Cheat Sheet: Common Geomatics Functions</a></li>
  <li><a href="#classification-example" id="toc-classification-example" class="nav-link" data-scroll-target="#classification-example">Classification Example</a>
  <ul class="collapse">
  <li><a href="#step-1" id="toc-step-1" class="nav-link" data-scroll-target="#step-1">Step 1</a></li>
  <li><a href="#step-2" id="toc-step-2" class="nav-link" data-scroll-target="#step-2">Step 2</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Coding Crossover</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Brent Murray, MGEM </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<p>This repository provides a side-by-side comparison of how to perform common geomatics tasks in&nbsp;R&nbsp;and&nbsp;Python. It focuses on the libraries&nbsp;<code>terra</code>&nbsp;and&nbsp;<code>sf</code>&nbsp;in R, and&nbsp;<code>rasterio</code>,&nbsp;<code>numpy</code>,&nbsp;<code>pandas</code>, and&nbsp;<code>geopandas</code>&nbsp;in Python.</p>
<section id="key-differences-in-python-vs.-r" class="level2">
<h2 class="anchored" data-anchor-id="key-differences-in-python-vs.-r">Key Differences in Python vs.&nbsp;R</h2>
<p>There are some key differences between Python and R that may take some time to get used to when switching between them.</p>
<p><strong>Indexing:</strong></p>
<ul>
<li><p>Python uses zero-based indexing (lists, arrays start from index 0).</p></li>
<li><p>R uses one-based indexing (vectors, matrices start from index 1).</p></li>
</ul>
<p><strong>Data structures:</strong></p>
<ul>
<li><p>Pythonâ€™s primary sequence structures are lists (mutable) and tuples (immutable), and numpy arrays for numerical operations.</p></li>
<li><p>Râ€™s core structures are vectores, matrices, data frames and lists, where vectors are a fundamental unit of operation.</p></li>
</ul>
<p><strong>Vectorization and broadcasting</strong></p>
<ul>
<li><p>R is inherently vectorized; many operations naturally apply element-wise without extra effort.</p></li>
<li><p>Python requires libraries like <code>NumPy</code> for similar vectorized operations and broadcasting.</p></li>
</ul>
<p><strong>Function arguments</strong></p>
<ul>
<li><p>In Python, keyword arguments (kwargs) are passed by name after positional arguments, and default values are common.</p></li>
<li><p>In R, arguments can be matched by position or name, and partial argument matching (unique abbreviations) is allowed.</p></li>
</ul>
<p><strong>Assignment</strong></p>
<ul>
<li><p>Python uses <code>=</code> for assignment.</p></li>
<li><p>R commonly uses <code>&lt;-</code> for assignment, though <code>=</code> can also be used.</p></li>
</ul>
<p><strong>Looping and iteration</strong></p>
<ul>
<li><p>Python encourages explicit loops (e.g., <code>for</code>, <code>while</code>), and list comprehension is widely used.<br>
<code>squares = [x**2 for x in range(10)] # example list comprehension</code></p></li>
<li><p>R encourages vectorized operations and <code>apply</code> functions over explicit <code>for</code> loops for efficiency and clarity.</p></li>
</ul>
<p><strong>String handling</strong></p>
<ul>
<li><p>Python has robust built-in string operations, slicing and methods.</p></li>
<li><p>R relies on more external packages (like stringr) for advanced text manipulation, though basic operations are available natively.</p></li>
</ul>
</section>
<section id="common-geomatics-libraries" class="level2">
<h2 class="anchored" data-anchor-id="common-geomatics-libraries">Common Geomatics Libraries</h2>
<p><strong>R Libraries</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Library</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong><code>terra</code></strong></td>
<td>For spatial data manipulation, raster data processing, and geospatial analysis.</td>
</tr>
<tr class="even">
<td><strong><code>sf</code></strong></td>
<td>For handling vector spatial data, including shapefiles, GeoJSON, and other formats.</td>
</tr>
<tr class="odd">
<td><strong><code>dplyr</code></strong></td>
<td>For data manipulation.</td>
</tr>
<tr class="even">
<td><strong><code>caret</code></strong></td>
<td>For training and plotting classification and regression models.</td>
</tr>
<tr class="odd">
<td><strong><code>ggplot2</code></strong></td>
<td>For creating graphics with provided data.</td>
</tr>
</tbody>
</table>
<p><strong>Python Libraries</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Library</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong><code>rasterio</code></strong></td>
<td>For raster file I/O and processing.</td>
</tr>
<tr class="even">
<td><strong><code>numpy</code></strong></td>
<td>For numerical data manipulation, often used with raster data.</td>
</tr>
<tr class="odd">
<td><strong><code>pandas</code></strong></td>
<td>For tabular data manipulation.</td>
</tr>
<tr class="even">
<td><strong><code>geopandas</code></strong></td>
<td>For handling vector spatial data, extending <code>pandas</code> to work with geospatial formats.</td>
</tr>
<tr class="odd">
<td><strong><code>shapely</code></strong></td>
<td>For manipulation and analysis of geometric objects.</td>
</tr>
<tr class="even">
<td><strong><code>scikit-learn</code></strong></td>
<td>For training classification, regression, and clustering models, and data preprocessing.</td>
</tr>
<tr class="odd">
<td><strong><code>matplotlib</code></strong></td>
<td>For creating graphics with provided data.</td>
</tr>
</tbody>
</table>
</section>
<section id="importing-libraries" class="level2">
<h2 class="anchored" data-anchor-id="importing-libraries">Importing Libraries</h2>
<p><strong>R</strong></p>
<pre><code># Import libraries 
library(terra)     # For raster operations 
library(sf)        # For vector operations 
library(dplyr)     # For data manipulation 
library(ggplot2)   # For creating visualizations</code></pre>
<p><strong>Python</strong></p>
<pre><code># Import libraries
import rasterio                                                     # For raster operations 
import geopandas as gpd                                             # For vector data 
import numpy as np                                                  # For numerical data 
import pandas as pd                                                 # For tabular data manipulation 
import matplotlib.pyplot as plt                                     # For creating visulizations 
from rasterio.features import rasterize                             # For rasterizing vector data 
from rasterio.mask import mask                                      # For masking raster data 
from rasterio.warp import calculate_default_transform, reproject    # For raster reprojection 
from shapely.geometry import box                                    # For creating bounding box</code></pre>
</section>
<section id="cheat-sheet-common-geomatics-functions" class="level2">
<h2 class="anchored" data-anchor-id="cheat-sheet-common-geomatics-functions">Cheat Sheet: Common Geomatics Functions</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 15%">
<col style="width: 36%">
<col style="width: 47%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Functionality</strong></th>
<th><strong>R (<code>terra</code>, <code>sf</code>)</strong></th>
<th><strong>Python (<code>rasterio</code>, <code>geopandas</code>, etc.)</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Read a shapefile</strong></td>
<td><code>shp &lt;- sf::st_read("path/to/file.shp")</code></td>
<td><code>shp = gpd.read_file("path/to/file.shp")</code></td>
</tr>
<tr class="even">
<td><strong>Write a shapefile</strong></td>
<td><code>sf::st_write(shp, "path/to/output.shp")</code></td>
<td><code>shp.to_file("path/to/output.shp")</code></td>
</tr>
<tr class="odd">
<td><strong>Read a raster</strong></td>
<td><code>raster &lt;- terra::rast("path/to/file.tif")</code></td>
<td><code>with rasterio.open("path/to/file.tif") as src:</code><br>
&nbsp;&nbsp;&nbsp;&nbsp;<code>raster = src.read()</code></td>
</tr>
<tr class="even">
<td><strong>Write a raster</strong></td>
<td><code>terra::writeRaster(raster, "path/to/output.tif", overwrite=TRUE)</code></td>
<td><code>with rasterio.open("path/to/output.tif", "w", **kwargs) as dst:</code><br>
&nbsp;&nbsp;&nbsp;&nbsp;<code>dst.write(raster)</code></td>
</tr>
<tr class="odd">
<td><strong>Calculate NDVI</strong></td>
<td><code>ndvi &lt;- (nir - red) / (nir + red)</code><br>
<em>(assuming <code>nir</code> and <code>red</code> are <code>terra</code> raster objects)</em></td>
<td><code>ndvi = (nir - red) / (nir + red)</code><br>
<em>(assuming <code>nir</code> and <code>red</code> are <code>numpy</code> arrays)</em></td>
</tr>
<tr class="even">
<td><strong>Clip a raster by extent</strong></td>
<td><code>clipped &lt;- terra::crop(raster, extent)</code></td>
<td><code>clipped, _ = mask(src, shapes, crop=True)</code></td>
</tr>
<tr class="odd">
<td><strong>Clip a vector by extent</strong></td>
<td><code>clipped &lt;- sf::st_crop(vector, xmin = x1, ymin = y1, xmax = x2, ymax = y2)</code></td>
<td><code>bbox = box(x1, y1, x2, y2)</code><br>
<code>clipped = vector.clip(bbox)</code></td>
</tr>
<tr class="even">
<td><strong>Reproject a shapefile</strong></td>
<td><code>reproj &lt;- sf::st_transform(shp, crs = 4326)</code></td>
<td><code>shp = shp.to_crs(epsg=4326)</code></td>
</tr>
<tr class="odd">
<td><strong>Reproject a raster</strong></td>
<td><code>reproj &lt;- terra::project(raster, "EPSG:4326")</code></td>
<td><code>reprojected_raster = reproject(src, transform)</code></td>
</tr>
<tr class="even">
<td><strong>Calculate area of polygons</strong></td>
<td><code>shp$area &lt;- sf::st_area(shp)</code></td>
<td><code>shp["area"] = shp.geometry.area</code></td>
</tr>
<tr class="odd">
<td><strong>Sort polygons by attribute</strong></td>
<td><code>sorted &lt;- shp[order(shp$attribute), ]</code></td>
<td><code>sorted = shp.sort_values("attribute")</code></td>
</tr>
<tr class="even">
<td><strong>Extract raster values</strong></td>
<td><code>values &lt;- terra::extract(raster, sf::st_coordinates(points))</code></td>
<td><code>values = [raster[row, col] for row, col in points]</code> <em>(requires array coordinates for <code>numpy</code>)</em></td>
</tr>
<tr class="odd">
<td><strong>Buffer around features</strong></td>
<td><code>buffered &lt;- sf::st_buffer(shp, dist = 500)</code></td>
<td><code>buffered = shp.buffer(500)</code></td>
</tr>
<tr class="even">
<td><strong>Rasterize a vector layer</strong></td>
<td><code>rasterized &lt;- terra::rasterize(shp, raster)</code></td>
<td><code>rasterized = rasterize([(geom, 1) for geom in shp.geometry], out_shape=shape, transform=transform)</code></td>
</tr>
</tbody>
</table>
</section>
<section id="classification-example" class="level2">
<h2 class="anchored" data-anchor-id="classification-example">Classification Example</h2>
<p>In GEM520 there was a lab assignment that focused on how to perform a supervised image classification using QGIS and R to represent the 7 land cover classes for the Gulf Islands. Within this lab training and validation polygons were delineated using QGIS and then used to train a Maximum Likelihood Classifier in R. In this example we will be using those same polygons and Landsat image but we will be doing the classification step using Python instead.</p>
<p><em>Note: it is recommended that you use the same polygons that you delineated for the lab to see if there are any differences in the outputs, but if you do not have them still you can access them <a href="https://github.com/ubc-mgem-fcor599/FCOR-599-Workshops/tree/main/CodingCrossover/data">here</a>.</em></p>
<section id="step-1" class="level3">
<h3 class="anchored" data-anchor-id="step-1">Step 1</h3>
<p>Before being able to run this example you will need to set up a Conda environment with the correct packages installed. To do this you will first need to download the <code>create_environment.py</code> script from <a href="https://github.com/ubc-mgem-fcor599/FCOR-599-Workshops/blob/main/CodingCrossover/scripts/create_environment.py">here</a>.</p>
<p>Next you need to open up Anaconda Prompt and type in <code>python [path/to/create_environment.py]</code>. This will create a new Conda environment for you with the correct packages and then open a new Jupyter Lab IDE.</p>
<p><em>Note: you do not need to run this example in the Jupter Lab IDE but the live tutorial will be done using it.</em></p>
</section>
<section id="step-2" class="level3">
<h3 class="anchored" data-anchor-id="step-2">Step 2</h3>
<p>Once the environment is created and Jupyter Lab is opened you can download the <code>supervised_classification.ipynb</code> from <a href="https://github.com/ubc-mgem-fcor599/FCOR-599-Workshops/blob/main/CodingCrossover/scripts/supervised_classification.ipynb">here</a>. This notebook will walk you through similar steps to the ones found in the original lab assignment. Open this notebook and run each of the code chunks.</p>
<p><em>Note: you will need to change the file paths within this notebook to the ones in your system and run each code chunk to show your results.</em></p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>